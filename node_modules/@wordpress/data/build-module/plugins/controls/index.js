/**
 * External dependencies
 */
import { applyMiddleware } from 'redux';
import { mapValues } from 'lodash';
/**
 * WordPress dependencies
 */

import createMiddleware from '@wordpress/redux-routine';
export default function (registry) {
  return {
    registerStore: function registerStore(reducerKey, options) {
      var store = registry.registerStore(reducerKey, options);

      if (options.controls) {
        var normalizedControls = mapValues(options.controls, function (control) {
          return control.isRegistryControl ? control(registry) : control;
        });
        var middleware = createMiddleware(normalizedControls);
        var enhancer = applyMiddleware(middleware);

        var createStore = function createStore() {
          return store;
        };

        Object.assign(store, enhancer(createStore)(options.reducer));
        registry.namespaces[reducerKey].supportControls = true;
      }

      return store;
    }
  };
}
//# sourceMappingURL=index.js.map